#!/bin/bash
#
# pop-up calendar for dzen
#
# based on (c) 2007, by Robert Manea
# http://dzen.geekmode.org/dwiki/doku.php?id=dzen:calendar
# modified by urukrama
#

TODAY=$(expr `date +'%d'` + 0)
MONTH=`date +'%m'`
YEAR=`date +'%Y'`
PADDING=15
SCREEN_HEIGHT=$(( $(sres -H) - $PADDING ))

echo $SCREEN_HEIGHT

CAL_WIDTH=160
CAL_HEIGHT=340

(
echo
\
# current month, hilight header and today
cal \
    | sed -re "s/^(.*[A-Za-z][A-Za-z]*.*)$/^fg(#bbbbbb)^bg(#303030)\1/;s/(^|[ ])($TODAY)($|[ ])/\1^bg(#bbbbbb)^fg(#222222)\2^fg(#6c6c6c)^bg(#bbbbbb)\3/"

# next month, hilight header
[ $MONTH -eq 12 ] && YEAR=`expr $YEAR + 1`
cal `expr \( $MONTH + 1 \) % 12` $YEAR \
    | sed -e 's/^\(.*[A-Za-z][A-Za-z]*.*\)$/^fg(#bbbbbb)^bg(#303030)\1/'
) \
  | panel -p 4 -x 1280 -y $(( $SCREEN_HEIGHT - $CAL_HEIGHT )) -w 160 -l 16 -sa c -e 'onstart=uncollapse;button1=exit'
